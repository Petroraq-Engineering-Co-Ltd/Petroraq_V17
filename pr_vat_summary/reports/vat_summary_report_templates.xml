<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- PDF Report Action -->
    <record id="vat_summary_pdf_report" model="ir.actions.report">
        <field name="name">VAT Summary</field>
        <field name="model">vat.summary.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">pr_vat_summary.vat_summary_pdf_template</field>
        <field name="report_file">pr_vat_summary.vat_summary_pdf_template</field>
        <!-- Safe python expression: dates â†’ strftime -->
        <field name="print_report_name">
            'VAT Summary - %s to %s' % (
            object.date_start and object.date_start.strftime('%Y-%m-%d') or '',
            object.date_end and object.date_end.strftime('%Y-%m-%d') or ''
            )
        </field>
    </record>


    <!-- QWeb PDF Template -->
    <template id="vat_summary_pdf_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="wizard">
                <t t-set="company" t-value="wizard.company_id"/>

                <!-- Compute the same helper values as HTML -->
                <t t-set="sales_vat_abs"
                   t-value="wizard.sales_vat if wizard.sales_vat &gt;= 0.0 else -wizard.sales_vat"/>
                <t t-set="pur_vat_abs"
                   t-value="wizard.vated_purchases_vat if wizard.vated_purchases_vat &gt;= 0.0 else -wizard.vated_purchases_vat"/>

                <t t-set="sales_total" t-value="wizard.sales_amount + sales_vat_abs"/>
                <t t-set="vated_pur_total" t-value="wizard.vated_purchases_amount + pur_vat_abs"/>
                <t t-set="non_vated_total" t-value="wizard.non_vated_purchases_amount"/>

                <!-- Summary row values (already computed in Python) -->
                <t t-set="amount_total" t-value="wizard.total_amount"/>
                <t t-set="vat_total" t-value="wizard.total_vat_payable"/>
                <!-- Grand total = Sales total - Vated purchase total (same as HTML) -->
                <t t-set="grand_total" t-value="sales_total - vated_pur_total"/>

                <div class="page">
                    <style>
                        table.vat-summary {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 15px;
                        margin-top: 15px;
                        }
                        table.vat-summary th {
                        background-color: #29608f;
                        color: white;
                        padding: 10px;
                        border: 2px solid #000000;
                        font-weight: bold;
                        text-align: center;
                        }
                        table.vat-summary td {
                        padding: 10px;
                        border: 1.8px solid #000000;
                        text-align: center;
                        vertical-align: middle;
                        }
                        table.vat-summary td.desc {
                        text-align: left;
                        font-weight: 500;
                        }
                        .section-title td {
                        background-color: #f5f5f5;
                        font-weight: bold;
                        border-top: 2px solid #000000;
                        border-bottom: 2px solid #000000;
                        }
                        .vat-title {
                        text-align: center;
                        font-size: 18px;
                        font-weight: bold;
                        margin-bottom: 8px;
                        }
                        .vat-period {
                        text-align: center;
                        margin-bottom: 15px;
                        font-size: 13px;
                        }
                    </style>

                    <!-- Header (same idea as HTML title) -->
                    <div class="vat-title">
                        <t t-esc="company.name"/>
                        - VAT Summary
                    </div>
                    <div class="vat-period">
                        Period:
                        <t t-esc="wizard.date_start"/>
                        to
                        <t t-esc="wizard.date_end"/>
                    </div>

                    <!-- TABLE: same structure as HTML -->
                    <table class="vat-summary">
                        <!-- Title row -->
                        <tr>
                            <th colspan="5">
                                VAT Report
                                <t t-esc="wizard.date_start"/>
                                to
                                <t t-esc="wizard.date_end"/>
                            </th>
                        </tr>

                        <!-- Header row -->
                        <tr>
                            <th>Sr. No</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>VAT 15%</th>
                            <th>Total</th>
                        </tr>

                        <!-- SALES SECTION -->
                        <tr class="section-title">
                            <td>1</td>
                            <td class="desc">
                                <b>Sales:</b>
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>i</td>
                            <td class="desc">Sales Revenue / Income</td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(wizard.sales_amount or 0.0)"/>
                            </td>
                            <!-- VAT should always display positive -->
                            <td>
                                <t t-esc="'{:,.2f}'.format(sales_vat_abs or 0.0)"/>
                            </td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(sales_total or 0.0)"/>
                            </td>
                        </tr>

                        <!-- PURCHASES SECTION -->
                        <tr class="section-title">
                            <td>2</td>
                            <td class="desc">
                                <b>Purchases :</b>
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>

                        <tr>
                            <td>i</td>
                            <td class="desc">Vated Purchase/Expenses</td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(wizard.vated_purchases_amount or 0.0)"/>
                            </td>
                            <!-- VAT should always display positive -->
                            <td>
                                <t t-esc="'{:,.2f}'.format(pur_vat_abs or 0.0)"/>
                            </td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(vated_pur_total or 0.0)"/>
                            </td>
                        </tr>

                        <tr>
                            <td>ii</td>
                            <td class="desc">Non Vated Purchase/Expenses</td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(wizard.non_vated_purchases_amount or 0.0)"/>
                            </td>
                            <td>-</td>
                            <td>
                                <t t-esc="'{:,.2f}'.format(non_vated_total or 0.0)"/>
                            </td>
                        </tr>

                        <!-- FINAL TOTAL ROW: same as HTML summary row -->
                        <tr class="section-title">
                            <td colspan="2" class="desc" style="text-align:center;">
                                <b>Total VAT Payable / Receivable</b>
                            </td>
                            <td>
                                <b>
                                    <t t-esc="'{:,.2f}'.format(amount_total or 0.0)"/>
                                </b>
                            </td>
                            <td>
                                <b>
                                    <t t-esc="'{:,.2f}'.format(vat_total or 0.0)"/>
                                </b>
                            </td>
                            <td>
                                <b>
                                    <t t-esc="'{:,.2f}'.format(grand_total or 0.0)"/>
                                </b>
                            </td>
                        </tr>
                    </table>
                </div>
            </t>
        </t>
    </template>

    <!-- XLSX Report -->
    <report
            id="vat_summary_xlsx_report"
            model="vat.summary.wizard"
            string="VAT Summary XLSX"
            report_type="xlsx"
            name="pr_vat_summary.vat_summary_xlsx"
            file="vat_summary_xlsx"
    />

</odoo>
