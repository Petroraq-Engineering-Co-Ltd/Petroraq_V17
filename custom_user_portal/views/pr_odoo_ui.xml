<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- List view for Purchase Requisition -->
    <record id="view_purchase_requisition_list" model="ir.ui.view">
        <field name="name">purchase.requisition.list</field>
        <field name="model">purchase.requisition</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="requested_by"/>
                <field name="approval"/>
                <field name="date_request"/>
            </tree>
        </field>
    </record>
    <!-- Form view for Purchase Requisition -->
    <record id="view_purchase_requisition_form" model="ir.ui.view">
        <field name="name">purchase.requisition.form</field>
        <field name="model">purchase.requisition</field>
        <field name="arch" type="xml">
            <form string="Purchase Requisition">
                <header>
                    <button name="action_create_rfq"
                        type="object"
                        string="Create RFQ"
                        class="btn-primary"
                        groups="custom_user_portal.procurement_admin"
                        invisible="not show_create_rfq_button"/>
                        <!-- Show Create Purchase Order button only if pr_type == 'cash' -->
                    <button name="action_create_purchase_order"
                            type="object"
                            string="Create Purchase Order"
                            class="btn-primary"
                            groups="custom_user_portal.procurement_admin"
                            invisible="not show_create_po_button"/>
                </header>
                <sheet>
                    <!-- Hidden fields for button visibility logic -->
                    <field name="pr_type" invisible="1"/>
                    <field name="show_create_rfq_button" invisible="1"/>
                    <field name="show_create_po_button" invisible="1"/>
                    
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="date_request" readonly="1"/>
                            <field name="department" readonly="1"/>
                            <field name="supervisor" readonly="1"/>
                            <field name="vendor_id" groups="custom_user_portal.procurement_admin"/>
                            <field name="status" invisible="1"/>
                        </group>
                        <group>
                            <field name="required_date" readonly="1"/>
                            <field name="priority" readonly="1"/>
                            <field name="budget_type" readonly="1"/>
                            <field name="budget_details" readonly="1"/>
                            <field name="is_supervisor" invisible="1"/>
                            <field name="approval" invisible="not is_supervisor"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Products">
                            <field name="line_ids" readonly="1">
                                <tree editable="bottom">
                                    <field name="description"/>
                                    <field name="type"/>
                                    <field name="unit"/>
                                    <field name="quantity"/>
                                    <field name="unit_price"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Notes">
                            <group>
                                <field name="notes" readonly="1"/>
                            </group>
                        </page>
                        <page string="Comments">
                            <group>
                                <field name="comments"/>
                            </group>
                        </page>
                        <page string="Reason">
                            <group>
                                <field name="rejection_reason"
                                       invisible="not is_supervisor"/>
                            </group>
                        </page>
                    </notebook>
                    <div class="total_amount_main">
                        <div class="total_amount_quotation">
                            <div class="total_padding total-amount-highlight">
                                <label for="total_excl_vat" style="padding: 0px 8px;"></label>
                                <field name="total_excl_vat" readonly="1" class="oe_inline"/>
                                
                            </div>
                            <!-- <div class="total_padding total-amount-highlight">
                                <label for="vat_amount" style="padding: 0px 8px;"></label>
                                <field name="vat_amount" readonly="1" class="oe_inline"/>
                            </div>
                            <div class="total_padding total-amount-highlight">
                                <label for="total_incl_vat" style="padding: 0px 8px;"></label>
                                <field name="total_incl_vat" readonly="1" class="oe_inline"/>
                            </div> -->
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>
    <!-- Action for Purchase Requisition list -->
    <record id="action_purchase_requisition_list" model="ir.actions.act_window">
        <field name="name">Purchase Requisitions</field>
        <field name="res_model">purchase.requisition</field>
        <field name="view_mode">tree,form</field>
        <field name="type">ir.actions.act_window</field>
        <field name="domain">[('pr_type', '!=', 'cash')]</field>
    </record>
    <!-- Menu item under Purchase -->
    <!-- End User Requisitions (folder, no action) -->
    <menuitem id="menu_purchase_requisition_main"
              name="Requisitions"
              parent="purchase.menu_purchase_root"
              sequence="130"
              groups="custom_pr_system.group_custom_pr_end_user"/>
    <!-- Re-parent PR menu -->
    <menuitem id="custom_pr_system.menu_pr"
            name="Regular PR"
            parent="custom_user_portal.menu_purchase_requisition_main"
            action="custom_pr_system.action_custom_pr_standard"
            sequence="10"
            groups="custom_pr_system.group_custom_pr_end_user"/>

    <!-- Re-parent Cash PR menu -->
    <menuitem id="custom_pr_system.menu_cash_pr"
            name="Cash PR"
            parent="custom_user_portal.menu_purchase_requisition_main"
            action="custom_pr_system.action_custom_pr_cash"
            sequence="20"
            groups="custom_pr_system.group_custom_pr_end_user"/>

    <!-- Requisitions for other users (shows PR lists) -->
    <menuitem id="menu_purchase_requisition_main_others"
              name="Requisitions"
              parent="purchase.menu_purchase_root"
              sequence="131"
              groups="custom_user_portal.procurement_admin,purchase.group_purchase_manager,custom_user_portal.project_engineer,custom_user_portal.project_manager,custom_user_portal.operations_director,custom_user_portal.managing_director,custom_pr_system.inventory_qc,custom_pr_system.inventory_data_entry,custom_user_portal.inventory_admin"/>

    <menuitem id="custom_user_portal.menu_pr_others"
            name="Regular PR"
            parent="custom_user_portal.menu_purchase_requisition_main_others"
            action="custom_user_portal.action_purchase_requisition_list"
            sequence="10"
            groups="custom_user_portal.procurement_admin,purchase.group_purchase_manager,custom_user_portal.project_engineer,custom_user_portal.project_manager,custom_user_portal.operations_director,custom_user_portal.managing_director,custom_pr_system.inventory_qc,custom_pr_system.inventory_data_entry,custom_user_portal.inventory_admin"/>

    <menuitem id="custom_user_portal.menu_cash_pr_others"
            name="Cash PR"
            parent="custom_user_portal.menu_purchase_requisition_main_others"
            action="custom_user_portal.action_purchase_requisition_cash"
            sequence="20"
            groups="custom_user_portal.procurement_admin,purchase.group_purchase_manager,custom_user_portal.project_engineer,custom_user_portal.project_manager,custom_user_portal.operations_director,custom_user_portal.managing_director,custom_pr_system.inventory_qc,custom_pr_system.inventory_data_entry,custom_user_portal.inventory_admin"/>
</odoo>