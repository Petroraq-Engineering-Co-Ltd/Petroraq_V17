<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_purchase_requisition_card" inherit_id="portal.portal_my_home">
        <xpath expr="//div[@id='portal_client_category']" position="after">
            <t t-if="request.env.user.employee_id">
                <div class="o_portal_category row g-2 mt-3" id="portal_pr_category">
                    <div class="col-12 col-md-6 col-lg-6">
                        <a href="/my/purchase-request" style="text-decoration: none;">
                            <div class="card h-100 border-0" style="background-color: #bcc2c8 !important;">
                                <div class="card-body d-flex flex-column justify-content-between">
                                    <div>
                                        <h6 class="text-muted text-uppercase">Purchase Requisition</h6>
                                        <p class="mb-2 text-dark">Submit and view your purchase requisitions</p>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </t>
        </xpath>
    </template>
    <!-- Page to List All PRs -->
    <template id="portal_purchase_request_list" name="My Purchase Requests">
        <t t-call="portal.portal_layout">
            <t t-set="title">My Purchase Requisitions</t>
            <div class="container my-4">
                <h2 class="mb-4">My Purchase Requisitions</h2>
                <a href="/my/purchase-request/create?type=pr" class="btn btn-primary mb-3" style="background-color: #122AA0 !important; border-color: #122AA0 !important;">
                    <i class="fa fa-plus me-1"></i> New PR
                </a>
                <a href="/my/purchase-request/create?type=cash" class="btn btn-secondary mb-3" style="background-color: #122AA0 !important; border-color: #122AA0 !important;">
                    <i class="fa fa-plus me-1"></i> Cash PR
                </a>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-white bg-warning shadow">
                            <div class="card-body">
                                <h5 class="card-title">Pending</h5>
                                <p class="card-text fs-4">
                                    <t t-esc="pending_count"/>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-success shadow">
                            <div class="card-body">
                                <h5 class="card-title">Approved</h5>
                                <p class="card-text fs-4">
                                    <t t-esc="approved_count"/>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-danger shadow">
                            <div class="card-body">
                                <h5 class="card-title">Rejected</h5>
                                <p class="card-text fs-4">
                                    <t t-esc="rejected_count"/>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>PR Number</th>
                            <th>Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-if="prs">
                            <t t-foreach="prs" t-as="pr">
                                <tr>
                                    <td>
                                        <a t-att-href="'/my/purchase_requisition/%s' % pr.id">
                                            <t t-esc="pr.name"/>
                                        </a>
                                    </td>
                                    <td>
                                        <t t-esc="pr.date_request.strftime('%Y-%m-%d') if pr.date_request else ''"/>
                                    </td>
                                    <td>
                                        <t t-esc="pr.approval"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                        <t t-if="not prs">
                            <tr>
                                <td colspan="3" class="text-center">No purchase requisitions found.</td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function () {
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.get('pr_submitted') === '1') {
                        alert('Purchase Requisition (PR) has been submitted successfully!');
                        // Remove the query param from the URL without reloading
                        if (history.replaceState) {
                            const cleanUrl = window.location.href.split('?')[0];
                            history.replaceState(null, null, cleanUrl);
                        }
                    }
                });
            </script>
        </t>
        <!-- RFQ alert -->
    </template>
    <template id="custom_portal_rfq_alert_inherit" inherit_id="purchase.portal_my_purchase_rfqs">
        <xpath expr="//t[@t-call='portal.portal_layout']" position="inside">
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function () {
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.get('quotation_submitted') === '1') {
                        alert('Quotation has been submitted successfully!');
                    if (history.replaceState) {
                            const cleanUrl = window.location.href.split('?')[0];
                            history.replaceState(null, null, cleanUrl);
                        }
                    }
                });
            </script>
        </xpath>
    </template>
    <!-- 
    <template id="custom_auth_signup_view" inherit_id="auth_signup.signup">
        
                <xpath expr="//a[contains(@class, 'btn-link') and contains(text(), 'Already have an account')]" position="replace">
            <a t-attf-href="/web/login?{{ keep_query() }}" class="btn btn-outline-secondary btn-sm" role="button">
                Have an account? Log in here
            </a>
        </xpath>

    </template> -->
</odoo>