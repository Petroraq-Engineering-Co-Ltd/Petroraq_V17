<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_order_form_inherit_petroraq_workflow" model="ir.ui.view">
        <field name="name">sale.order.form.petroraq.workflow</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <field name="show_manager_approve_button" modifiers="{'invisible': True}"/>
                <field name="show_md_approve_button" modifiers="{'invisible': True}"/>
                <button string="Manager Approve"
                        type="object"
                        name="action_manager_approve"
                        class="oe_highlight"
                        modifiers="{'invisible': [('show_manager_approve_button', '=', False)]}"
                        groups="petroraq_sale_workflow.group_sale_approval_manager,sales_team.group_sale_manager,petroraq_sale_workflow.group_sale_approval_md"/>
                <button string="MD Approve"
                        type="object"
                        name="action_md_approve"
                        class="oe_highlight"
                        modifiers="{'invisible': [('show_md_approve_button', '=', False)]}"
                        groups="petroraq_sale_workflow.group_sale_approval_md"/>
                <button string="Reject"
                        type="object"
                        name="action_reject"
                        class="btn-secondary"
                        modifiers="{'invisible': [('approval_state', 'not in', ['to_manager', 'to_md'])]}"
                        groups="petroraq_sale_workflow.group_sale_approval_manager,petroraq_sale_workflow.group_sale_approval_md,sales_team.group_sale_manager"/>
            </xpath>
        </field>
    </record>

    <record id="view_order_form_petroraq_payment_terms" model="ir.ui.view">
        <field name="name">sale.order.form.petroraq.payment.terms</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='payment_term_id']" position="attributes">
                <attribute name="domain">[('petroraq_selectable','=',True)]</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_order_line_hide_taxes" model="ir.ui.view">
        <field name="name">sale.order.form.hide.taxes</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='order_line']/tree//field[@name='tax_id']" position="replace"/>
            <xpath expr="//field[@name='order_line']/tree//field[@name='price_subtotal']" position="attributes">
                <attribute name="string">Total Amount</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree//field[@name='product_uom_qty']" position="after">
                <field name="product_uom"
                       force_save="1"
                       string="Unit"
                       readonly="product_uom_readonly"
                       required="not display_type"
                       context="{'company_id': parent.company_id}"
                       options="{'no_open': True}"
                       optional="show"/>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree//field[@name='product_uom'][@optional='show' and @groups='uom.group_uom']" position="attributes">
                <attribute name="column_invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='order_line']/tree/field[@name='name']" position="after">
                <field name="section_subtotal_display"
                       widget="html"
                       readonly="1"
                       invisible="1"
                       column_invisible="True"/>
            </xpath>
            <xpath expr="//group[@name='sale_total']/field[@name='tax_totals']" position="replace">
                <div class="o_petroraq_totals">
                    <div class="o_petroraq_total_row o_petroraq_total_base">
                        <span class="o_petroraq_total_label">Total Amount</span>
                        <field name="amount_total" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                    <div class="o_petroraq_total_row o_petroraq_total_overhead">
                        <div class="o_petroraq_total_left">
                            <span class="o_petroraq_total_label">Over Head (%)</span>
                            <field name="overhead_percent" class="o_petroraq_percent_input" nolabel="1"/>
                        </div>
                        <field name="overhead_amount" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                    <div class="o_petroraq_total_row o_petroraq_total_risk">
                        <div class="o_petroraq_total_left">
                            <span class="o_petroraq_total_label">Risk (%)</span>
                            <field name="risk_percent" class="o_petroraq_percent_input" nolabel="1"/>
                        </div>
                        <field name="risk_amount" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                    <div class="o_petroraq_total_row o_petroraq_total_grand">
                        <span class="o_petroraq_total_label">Grand Total</span>
                        <field name="buffer_total_amount" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                    <div class="o_petroraq_total_row o_petroraq_total_profit">
                        <div class="o_petroraq_total_left">
                            <span class="o_petroraq_total_label">Profit (%)</span>
                            <field name="profit_percent" class="o_petroraq_percent_input" nolabel="1"/>
                        </div>
                        <field name="profit_amount" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                    <div class="o_petroraq_total_row o_petroraq_total_great">
                        <span class="o_petroraq_total_label">Great Grand Total</span>
                        <field name="profit_grand_total" widget="monetary" readonly="1" class="o_petroraq_total_value" nolabel="1"/>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
</odoo>
